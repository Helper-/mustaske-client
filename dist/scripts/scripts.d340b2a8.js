!function(){"use strict";angular.module("mustaskeClientApp",["ngAnimate","ngCookies","ngResource","ngRoute","ngSanitize","ngMaterial","ngMessages","btford.socket-io","chart.js"])}(),function(){"use strict";function a(a){a.otherwise({redirectTo:"/"})}var b=angular.module("mustaskeClientApp");b.config(["$routeProvider",a])}(),function(){"use strict";function a(a,f){d=a,e=f,c(),b()}function b(){e.fontSet("fa","fontawesome")}function c(){d.definePalette("mustaskePrimary",{50:"#3f7baf",100:"#386e9c",200:"#316189",300:"#2a5377",400:"#244664",500:"#1D3951",600:"#162c3e",700:"#101f2b",800:"#ffffff",900:"#ffffff",A100:"#4988be",A200:"#5c94c5",A400:"#6fa1cb",A700:"#ffffff",contrastDefaultColor:"light",contrastDarkColors:"50 100 200 A100 A200"}),d.definePalette("mustaskeAccent",{50:"#ffffff",100:"#ffffff",200:"#ffffff",300:"#fbfbfb",400:"#efefef",500:"#E2E2E2",600:"#d5d5d5",700:"#c8c8c8",800:"#bcbcbc",900:"#afafaf",A100:"#ffffff",A200:"#ffffff",A400:"#ffffff",A700:"#a2a2a2"}),d.theme("default").primaryPalette("mustaskePrimary").accentPalette("mustaskeAccent")}angular.module("mustaskeClientApp").config(["$mdThemingProvider","$mdIconProvider",a]);var d,e}(),function(){"use strict";angular.module("mustaskeClientApp").run(["$rootScope","$location",function(a,b){a.$on("$locationChangeStart",function(a,b,c){console.log("$locationChangeStart",a,"Next",b,"current",c)})}])}(),function(){"use strict";angular.module("mustaskeClientApp").directive("loginOverlay",function(){return{templateUrl:"views/login-overlay.tpl.html",restrict:"E",scope:{},controller:"OverlayController",controllerAs:"ctrl"}})}(),function(){"use strict";function a(a,f,g){return c=a,d=f,e=g,{templateUrl:"views/question-card.tpl.html",restrict:"E",scope:{question:"="},link:b}}function b(a){a.hide=!0,a.warned=0;var b={isUpVoted:!0};a.voteControls=b,a.detailToggle=function(){c.debug(a.hide),a.hide=!a.hide},a.upVote=function(a){a.hasVotedUp?a.hasVotedUp=!1:(a.hasVotedUp=!0,a.hasVotedDown&&(a.hasVotedDown=!1)),e.upVoteQuestion(a.question_id)},a.downVote=function(a){a.hasVotedDown?a.hasVotedDown=!1:(a.hasVotedDown=!0,a.hasVotedUp&&(a.hasVotedUp=!1)),e.downVoteQuestion(a.question_id)},a.isRoomOwner=d.isRoomOwner(),a.dismiss=function(a){e.dismissQuestion(a.question_id)},a.warn=function(b){ga("send","event","Question","WarnUser"),++a.warned,e.warnUser(b.question_id)}}angular.module("mustaskeClientApp").directive("questionCard",["$log","UserService","SocketService","$timeout",a]);var c,d,e}(),function(){"use strict";function a(a,e){return d=a,c=e,{templateUrl:"views/question-input-fab.tpl.html",restrict:"E",scope:{},link:b}}function b(a){a.openOpenBottomSheet=function(){c.show({templateUrl:"views/question-input-bottom-sheet.tpl.html",controller:"QuestionInputController",controllerAs:"ctrl",clickOutsideToClose:!1}).then(function(a){d.debug(a)})}}angular.module("mustaskeClientApp").directive("questionInputFab",["$log","$mdBottomSheet",a]);var c,d}(),function(){"use strict";function a(){return{templateUrl:"views/topbar.tpl.html",restrict:"E"}}angular.module("mustaskeClientApp").directive("topbar",[a])}(),function(){"use strict";function a(a){return c=a,{templateUrl:"views/clicker-input-button.tpl.html",restrict:"E",scope:{},link:b}}function b(a){a.openOpenBottomSheet=function(){c.show({templateUrl:"views/clicker-input-bottom-sheet.tpl.html",controller:"ClickerInputController",controllerAs:"ctrl",clickOutsideToClose:!1})}}angular.module("mustaskeClientApp").directive("clickerInput",["$mdBottomSheet",a]);var c}(),function(){"use strict";function a(){return{templateUrl:"views/top-questions.view.html",controller:"TopQuestionsController",controllerAs:"ctrl",scope:{},restrict:"E"}}angular.module("mustaskeClientApp").directive("topQuestions",[a])}(),function(){"use strict";function a(){return{templateUrl:"views/recent-questions.view.html",controller:"RecentQuestionsController",controllerAs:"ctrl",scope:{},restrict:"E"}}angular.module("mustaskeClientApp").directive("recentQuestions",[a])}(),function(){"use strict";function a(){return{templateUrl:"views/poll.view.html",controller:"PollController",controllerAs:"ctrl",scope:{},restrict:"E"}}angular.module("mustaskeClientApp").directive("poll",[a])}(),function(){"use strict";function a(){return{templateUrl:"views/settings.view.html",controller:"SettingsController",controllerAs:"ctrl",scope:{},restrict:"E"}}angular.module("mustaskeClientApp").directive("settings",[a])}(),function(){"use strict";function a(a,e){return c=a,d=e,{template:"<span>{{time}}</span>",restrict:"E",scope:{timer:"="},link:b}}function b(a){function b(){f++,60===f&&(f=0,g++);var b=f.toString(),c=g.toString();f<10&&(b="0"+b),a.time=c+":"+b}a.internalTimer=a.timer||{},a.internalTimer.start=function(){a.time="0:00",f=0,g=0,e=d(b,1e3)},a.internalTimer.stop=function(){d.cancel(e),a.time="0:00"}}angular.module("mustaskeClientApp").directive("maTimer",["$log","$interval",a]);var c,d,e,f=0,g=0}(),function(){"use strict";function a(a){b=a,c=[]}angular.module("mustaskeClientApp").service("AppService",["$log",a]);var b,c;a.prototype.reset=function(){c.forEach(function(a){a.call()})},a.prototype.manageClear=function(a){c.push(a)}}(),function(){"use strict";function a(a,b,k,l,m){e=a,d=k,f=b,g=l,i=m,c=this,c.events={JOIN_ROOM:"join room",CREATE_ROOM:"create room",NEW_QUESTION:"new question",UP_VOTE_QUESTION:"upvote question",DOWN_VOTE_QUESTION:"downvote question",SET_POLL_ACTIVE:"set active poll",START_POLL:"start poll",STOP_POLL:"stop poll",VOTE_POLL:"vote poll",DISMISS_QUESTION:"dismiss question",WARN_USER:"warn user",BAN_USER:"ban user",LEAVE_ROOM:"leave room"},h=i.alert().clickOutsideToClose(!0).title("You've been warned").textContent('The first time you warn a asker of a question it will do just that, "warn" the user by giving them a alert. The second time you warn that same user is banned from the room. So yeah, be cool.').ok("Got it!"),j=_.once(function(){i.show(h)})}function b(a){var b=f.defer();return d.on(a,function(c){e.debug("SocketService:response",a,c),c?b.resolve(c):b.reject(c)}),b.promise}angular.module("mustaskeClientApp").service("SocketService",["$log","$q","Socket","RoomService","$mdDialog",a]);var c,d,e,f,g,h,i,j;a.prototype.joinRoom=function(a){return e.debug("SocketService#joinRoom:roomId:",a),d.emit(c.events.JOIN_ROOM,a),b(c.events.JOIN_ROOM)},a.prototype.createRoom=function(a){return e.debug("SocketService#createRoom:roomName:",a),d.emit(c.events.CREATE_ROOM,a),b(c.events.CREATE_ROOM)},a.prototype.newQuestion=function(a){e.debug("SocketService#newQuestion:question:",a),d.emit(c.events.NEW_QUESTION,a)},a.prototype.upVoteQuestion=function(a){var b=g.getRoomId();e.debug("SocketService#upVoteQuestion:questionId:",a,b),d.emit(c.events.UP_VOTE_QUESTION,{room_id:b,question_id:a})},a.prototype.downVoteQuestion=function(a){var b=g.getRoomId();e.debug("SocketService#upVoteQuestion:questionId:",a,b),d.emit(c.events.DOWN_VOTE_QUESTION,{room_id:b,question_id:a})},a.prototype.dismissQuestion=function(a){var b=g.getRoomId();e.debug("SocketService#dismissQuesiton:questionId:",a,b),d.emit(c.events.DISMISS_QUESTION,{room_id:b,question_id:a})},a.prototype.warnUser=function(a){j();var b=g.getRoomId();e.debug("SocketService#warnUser:questionId:",a,b),d.emit(c.events.WARN_USER,{room_id:b,question_id:a})},a.prototype.activatePolling=function(){var a=g.getRoomId();e.debug("SocketService#activatePolling:",a),d.emit(c.events.SET_POLL_ACTIVE,{room_id:a,active:!0})},a.prototype.deactivatePolling=function(){var a=g.getRoomId();e.debug("SocketService#deactivatePolling:",a),d.emit(c.events.SET_POLL_ACTIVE,{room_id:a,active:!1})},a.prototype.votePoll=function(a){e.debug("SocketService#votePoll:option:",a),d.emit(c.events.VOTE_POLL,{room_id:g.getRoomId(),option:a})},a.prototype.io=function(){return d},a.prototype.deleteRoom=function(a){e.debug("SocketService#deleteRoom:roomId:",a),d.emit(c.events.LEAVE_ROOM,a)}}(),function(){"use strict";function a(a,e){b=this,c=a,d=e}angular.module("mustaskeClientApp").service("SettingsService",["SocketService","UserService",a]);var b,c,d}(),function(){"use strict";function a(a,d){e=a,c=this,c.types={AUDIENCE:"audience",OWNER:"owner"},b(),_.once(d.manageClear(c.clear))}function b(){d={answers:[]},f={},d.type=c.types.AUDIENCE}angular.module("mustaskeClientApp").service("UserService",["$log","AppService",a]);var c,d,e,f;a.prototype.clear=function(){b()},a.prototype.setRoomData=function(a){angular.extend(f,a)},a.prototype.setUser=function(a){d=a},a.prototype.setUserType=function(a){d.type=a},a.prototype.setUserId=function(a){d.id=a},a.prototype.getType=function(){return d.type},a.prototype.isRoomOwner=function(){return"owner"===d.type},a.prototype.getUserId=function(){return d.id},a.prototype.getRoomName=function(){return f?f.room_name:void 0},a.prototype.getRoomId=function(){return f?f.room_id:void 0},a.prototype.getAnswers=function(){return d.answers},a.prototype.addPollAnswer=function(a){return d.answers?(d.answers.push(a),d.answers):(d.answers=[a],d.answers)}}(),function(){"use strict";function a(a,c,g){d=c,f=a,e=this,b(),_.once(g.manageClear(e.clear))}function b(){c={has_room:!1,room_name:"",room_id:"",questions:[],top_questions:[],active_poll:""}}angular.module("mustaskeClientApp").service("RoomService",["$rootScope","$log","AppService",a]);var c,d,e,f;a.prototype.clear=function(){b()},a.prototype.setRoomData=function(a){c.has_room=!0,c.room_name=a.room_name,c.room_id=a.room_id,c.active_poll=a.active_poll,a.questions&&a.questions.length>0&&c.questions.push.apply(c.questions,a.questions),a.top_questions&&a.top_questions.length>0&&c.top_questions.push.apply(c.top_questions,a.top_questions)},a.prototype.addQuestion=function(a){c.questions.unshift(a)},a.prototype.getTopQuestions=function(){return c.questions},a.prototype.getQuestions=function(){return c.questions},a.prototype.getRoomId=function(){return c.room_id},a.prototype.getRoomName=function(){return c.room_name},a.prototype.getActivePoll=function(){return c.active_poll},a.prototype.setActivePoll=function(a){c.active_poll=a},a.prototype.getRoomData=function(){return c},a.prototype.hasRoom=function(){return c.has_room},a.prototype.updateVote=function(a){angular.forEach(c.questions,function(b){b.question_id===a.question_id&&(b.question_score=a.question_score)})},a.prototype.dismissQuestion=function(a){for(var b=0;c.questions.length>b;b++)if(c.questions[b].question_id===a)return void c.questions.splice(b,1)}}(),function(){"use strict";function a(a,f,i,j){c=this,e=f,d=a,h=i,g=["A","B","C","D","E"],b(),_.once(j.manageClear(c.clear))}function b(){f={current:"",all:[]},c.isPollStarted=!1,i=!1}angular.module("mustaskeClientApp").service("ClickerService",["$mdBottomSheet","SocketService","RoomService","AppService",a]);var c,d,e,f,g,h,i;a.prototype.clear=function(){b(),d.cancel()},a.prototype.getButtons=function(){return g},a.prototype.openClicker=function(){d.show({templateUrl:"views/clicker-input-bottom-sheet.tpl.html",controller:"ClickerInputController",controllerAs:"ctrl",clickOutsideToClose:!0})},a.prototype.closeClicker=function(){d.cancel()},a.prototype.getPollStatus=function(){return h.getActivePoll()&&(c.isPollStarted=!0,h.setActivePoll(!1),c.isActivePoll=!0,c.openClicker()),c.isPollStarted},a.prototype.setPollStatus=function(a){c.isPollStarted=a},a.prototype.vote=function(a){e.votePoll(a),f.current=a},a.prototype.saveCurrentVote=function(){f.all.push(f.current)},a.prototype.getAnswers=function(){return f},a.prototype.getActivePoll=function(){return h.getRoomData()},a.prototype.setActivePoll=function(a){i=a}}(),function(){"use strict";function a(a,c,d,e,f){b=a;var g=!1,h=0,i=io.connect(void 0,{reconnectionAttempts:5,multiplex:!1}),j=e.simple().hideDelay(0).action("Close").highlightAction(!0).textContent("Error connecting to server... Trying to reconnect."),k=e.simple().hideDelay(0).action("Close").highlightAction(!0).textContent("Unable to reconnect to server... \nTry refreshing page.");e.simple().hideDelay(0).action("Close").highlightAction(!0).textContent("You have tragically been disconnected. Refresh the page to reconnect to create/rejoin room.");return i.on("connect",function(){g&&(g=!1,h=0,e.hide()),b.info("connected",i.connected)}),i.on("connect_error",function(a){b.error("Error connecting to socket",a),g||(g=!0,e.show(j))}),i.on("reconnect_failed",function(a){b.error("Failed to reconnecting to socket",a),e.show(k),f.hasRoom()&&d.$emit("reconnect.failed")}),c({ioSocket:i})}angular.module("mustaskeClientApp").factory("Socket",["$log","socketFactory","$rootScope","$mdToast","RoomService",a]);var b}(),function(){"use strict";function a(a){return c=a,b}function b(a,b){d=b,f={},e=a,angular.forEach(e,function(a){f[a]=0}),d[0]=_.values(f)}angular.module("mustaskeClientApp").factory("Votes",["$log",a]);var c,d,e,f,g;b.prototype.updateVotes=function(a){angular.forEach(a,function(a,b){f[b]=a});var b=_.values(f);g=_.foldl(b,function(a,b){return a+b},0),g<=0||(d[0]=_.map(b,function(a){return a/g*100}))},b.prototype.clear=function(){this.init()},b.prototype.init=function(){f={},angular.forEach(e,function(a){f[a]=0}),d[0]=_.values(f)}}(),function(){"use strict";function a(a,c,d,e,f,g,r,s,t){m=d,l=c,n=e,k=r,j=g,o=s,i=a,p=f,h=this,q=f.simple().action("Close").highlightAction(!0).textContent("Error joining room. Double check your room id (Ex. fluffy-beaver-82)."),h.input={pattern:/^[A-Za-z]+-[A-Za-z]+-\d+$/},b(),_.once(t.manageClear(h.clear))}function b(){h.showRoom=!1,h.isLeaving=!1,h.overlayHide=!1,h.roomName="",m.isRoomOwner="",m.roomName="",m.roomId=""}function c(a){i.debug("Failed to join room: ",a),p.show(q)}function d(a){j.setRoomData(a),o.setRoomData(a),i.debug(j.getType()),i.debug(j.getRoomName()),m.roomName=j.getRoomName(),m.roomId=o.getRoomId(),h.overlayHide=!0}function e(a){i.debug("Failed to join room: ",a)}function f(a){o.setRoomData(a),j.setRoomData(a),j.setUserType("owner"),i.debug(j.getType()),i.debug(j.getRoomName()),m.isRoomOwner=j.isRoomOwner(),m.roomName=o.getRoomName(),m.roomId=o.getRoomId(),h.overlayHide=!0}var g=angular.module("mustaskeClientApp");g.controller("OverlayController",["$log","$scope","$rootScope","$mdDialog","$mdToast","UserService","SocketService","RoomService","AppService",a]);var h,i,j,k,l,m,n,o,p,q;a.prototype.clear=function(){h.isLeaving=!0,h.roomName="",h.overlayHide=!1,m.isRoomOwner="",m.roomName="",m.roomId=""},a.prototype.joinRoom=function(){k.joinRoom(h.roomName.toLowerCase()).then(d,c)},a.prototype.createRoom=function(){k.createRoom(h.roomName).then(f,e)},a.prototype.help=function(){n.show({templateUrl:"views/help.tpl.html",clickOutsideToClose:!0,controller:["$scope","$mdDialog",function(a,b){ga("send","event","Help","HelpOpened"),a.close=function(){b.hide()}}]})}}(),function(){"use strict";function a(a,c,m,n,o,p,q,r){e=a,f=o,g=p,h=q,i=n,j=r,k=m,l=c,e.debug("$scope is: ",c),e.debug("$rootScope is: ",m),d=this,d.selectedIndex=0,d.isFabOpen=!1,m.$watch("appCtrl.selectedIndex",function(a){switch(e.debug("index change"),a){case 0:ga("send","event","Tabs","RecentQuestions");break;case 1:ga("send","event","Tabs","TopQuestions");break;case 2:ga("send","event","Tabs","Polls");break;case 3:ga("send","event","Tabs","Settings")}}),b()}function b(){var a=f.io();a.on(f.events.NEW_QUESTION,function(a){g.addQuestion(a)}),a.on(f.events.UP_VOTE_QUESTION,function(a){g.updateVote(a)}),a.on(f.events.DOWN_VOTE_QUESTION,function(a){g.updateVote(a)}),a.on(f.events.DISMISS_QUESTION,function(a){g.dismissQuestion(a)}),a.on(f.events.WARN_USER,function(a){i.show(i.simple().textContent("You've been issued a warning by the room owner. If you are warned again you will be banned from the room."))}),a.on(f.events.BAN_USER,function(a){f.deleteRoom(a)}),a.on(f.events.LEAVE_ROOM,function(){j.reset(),d.selectedIndex=0,d.isFabOpen=!1,k.$emit("leaving.room")}),k.$on("reconnect.failed",function(){j.reset(),d.selectedIndex=0,d.isFabOpen=!1})}var c=angular.module("mustaskeClientApp");c.controller("AppController",["$log","$rootScope","$scope","$mdToast","SocketService","RoomService","UserService","AppService",a]);var d,e,f,g,h,i,j,k,l}(),function(){"use strict";function a(a,c,d,e,o,p,q,r,s){g=c,h=d,i=e,j=o,k=p,m=q,l=a,f=this,f.timer={},f.answers=j.getAnswers(),f.buttons=j.getButtons(),f.isActivePoll=j.getActivePoll(),f.chart={labels:f.buttons,data:[[30,50,5,10,5]],options:{scaleShowGridLines:!1,scaleShowHorizontalLines:!1,scaleShowVerticalLines:!1,responsive:!0,maintainAspectRatio:!1,barShowStroke:!1,barValueSpacing:15,scaleShowLabels:!1,tooltipTemplate:'<%= value + " %" %>'},colours:[{fillColor:"#1D3951"}]},n=new r(f.chart.labels,f.chart.data),_.once(s.manageClear(f.clear)),b()}function b(){f.poll={counter:0,isPollStarted:!1},f.isRoomOwner=!1,h.$watch(function(){return j.getPollStatus()},function(a){f.poll.isPollStarted=a}),h.$watch(function(){return k.isRoomOwner()},function(a){f.isRoomOwner=a}),h.$watch(function(){return j.getActivePoll()},function(a){f.isActivePoll=a}),h.$watch(function(){return j.getAnswers()},function(a){f.answers=a}),m.io().on(m.events.START_POLL,d),m.io().on(m.events.STOP_POLL,c),m.io().on(m.events.VOTE_POLL,e)}function c(){l.debug("Pull stopped"),f.poll.isPollStarted=!1,f.isActivePoll||f.timer.stop(),n.updateVotes({A:0,B:0,C:0,D:0,E:0}),k.isRoomOwner()||(j.closeClicker(),j.saveCurrentVote())}function d(a){l.debug("Pull started",a),f.isActivePoll=!1,f.poll.isPollStarted=!0,f.timer.start(),k.isRoomOwner()||j.openClicker()}function e(a){l.debug("Poll vote",a),n.updateVotes(a)}angular.module("mustaskeClientApp").controller("PollController",["$log","$interval","$scope","$rootScope","ClickerService","UserService","SocketService","Votes","AppService",a]);var f,g,h,i,j,k,l,m,n;a.prototype.clear=function(){f.poll={counter:0,isPollStarted:!1},n.clear(),f.timer.stop()},a.prototype.startPoll=function(){m.activatePolling()},a.prototype.stopPoll=function(){m.deactivatePolling(),j.setActivePoll(!1)},a.prototype.restartVote=function(){f.poll.isPollStarted&&j.openClicker()}}(),function(){"use strict";function a(a,f,g){e=a,c=this,d=f,b(),_.once(g.manageClear(c.clear))}function b(){c.topIndex=0,c.questions=d.getQuestions(),e.debug("Questions: ",c.questions)}angular.module("mustaskeClientApp").controller("RecentQuestionsController",["$log","RoomService","AppService",a]);var c,d,e;a.prototype.clear=function(){b(),c.questions.length=0}}(),function(){"use strict";function a(a,f,g,h){e=a,d=g,c=f,b=this,b.topIndex=0,b.topQuestions=d.getTopQuestions(),e.debug("Top Questions: ",b.topQuestions),_.once(h.manageClear(b.clear))}angular.module("mustaskeClientApp").controller("TopQuestionsController",["$log","SocketService","RoomService","AppService",a]);var b,c,d,e;a.prototype.clear=function(){b.topIndex=0,b.topQuestions=d.getTopQuestions(),b.topQuestions.lenght=0},a.prototype.zeroOrNull=function(a){return void 0!==a.question_score&&a.question_score>0}}(),function(){"use strict";function a(a,h,i,j,k){c=this,f=a,g=j,d=i,e=h,c.newQuestion="",b(),_.once(k.manageClear(c.clear))}function b(){c.newQuestion=""}angular.module("mustaskeClientApp").controller("QuestionInputController",["$log","$mdBottomSheet","SocketService","RoomService","AppService",a]);var c,d,e,f,g;a.prototype.clear=function(){b()},a.prototype.submitQuestion=function(a){var b={room_id:g.getRoomId(),question_text:c.newQuestion};d.newQuestion(b),e.hide(c.newQuestion),a&&a.preventDefault()}}(),function(){"use strict";function a(a,i,j,k,l){g=a,d=j,e=k,f=l,h=i,c=this,b()}function b(){h.$watch(function(){return d.getRoomId()},function(a){c.roomId=a}),h.$watch(function(){return e.isRoomOwner()},function(a){c.message=a?"Delete Room":"Leave Room"})}angular.module("mustaskeClientApp").controller("SettingsController",["$log","$scope","RoomService","UserService","SocketService",a]);var c,d,e,f,g,h;a.prototype.removeRoom=function(){f.deleteRoom(c.roomId)}}(),function(){"use strict";function a(a,f,g){c=g,d=f,e=a,b=this,b.answers=d.getAnswers(),b.buttons=d.getButtons()}angular.module("mustaskeClientApp").controller("ClickerInputController",["$log","ClickerService","SocketService",a]);var b,c,d,e;a.prototype.submitAnswer=function(a){d.vote(a)}}();